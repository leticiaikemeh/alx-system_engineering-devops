#!/bin/bash

# Define the digit mappings for WATER (base water)
declare -A water_base=(
  [w]=0 [a]=1 [t]=2 [e]=3 [r]=4
)
# The base is 5
water_base_digits=(w a t e r)
water_base_length=5

# Define the digit mappings for STIR (base stir)
declare -A stir_base=(
  [t]=0 [i]=1 [r]=2 [s]=3
)
# The base is 4
stir_base_digits=(t i r s)
stir_base_length=4

# The output base BESTCHOL
declare -A bestchol_base=(
  [b]=0 [e]=1 [s]=2 [t]=3 [c]=4 [h]=5 [o]=6 [l]=7
)
bestchol_base_digits=(b e s t c h o l)
bestchol_base_length=8

# Function to convert a string in a custom base to decimal
to_decimal() {
  local str="$1"
  local -n base_map=$2
  local base=$3
  local len=${#str}
  local num=0
  for (( i=0; i<len; i++ )); do
    ch=${str:i:1}
    digit=${base_map[$ch]}
    if [ -z "$digit" ]; then
      echo "Invalid character: $ch" >&2
      exit 1
    fi
    num=$(( num * base + digit ))
  done
  echo "$num"
}

# Function to convert decimal to a string in a custom base
from_decimal() {
  local num=$1
  local -n digits=$2
  local base=${#digits[@]}
  if [ "$num" -eq 0 ]; then
    echo "${digits[0]}"
    return
  fi
  local result=""
  while [ "$num" -gt 0 ]; do
    rem=$(( num % base ))
    result="${digits[rem]}$result"
    num=$(( num / base ))
  done
  echo "$result"
}

# Read environment variables
WATER_NUM=$(to_decimal "$WATER" water_base "$water_base_length")
STIR_NUM=$(to_decimal "$STIR" stir_base "$stir_base_length")

# Sum the numbers
SUM=$(( WATER_NUM + STIR_NUM ))

# Convert sum to BESTCHOL
RESULT=$(from_decimal "$SUM" bestchol_base_digits)

# Output result
echo "$RESULT"
